<?xml version="1.0" encoding="UTF-8"?>
<odoo>
  <!-- Add smart button on vendor bill to open related delivery -->
  <record id="view_move_form_inherit_delivery_custom" model="ir.ui.view">
    <field name="name">account.move.form.delivery.custom</field>
    <field name="model">account.move</field>
    <field name="inherit_id" ref="account.view_move_form"/>
    <field name="arch" type="xml">
      <!-- Place next to Payments/Purchase smart buttons -->
      <xpath expr="//form//div[@name='button_box']/button[@name='open_payments']" position="after">
        <button name="action_open_picking"
                type="object"
                class="oe_stat_button"
                icon="fa-truck"
                string="Delivery"
                invisible="move_type != 'in_invoice' or not has_related_picking"/>
      </xpath>
      <!-- Ensure fields are present for attrs to evaluate properly -->
      <xpath expr="//form//sheet//field[@name='invoice_has_outstanding']" position="after">
        <field name="has_related_picking" invisible="1"/>
        <field name="picking_id" invisible="1"/>
      </xpath>
    </field>
  </record>
</odoo>
